{% extends 'layout/inner_page.html' %}

{% load pages_extras %}
{% load stb_extras %}

{% block content %}
  {% include 'components/breadcrumbs.html' with page=page only %}
  {% include 'components/page_h1.html' with page=page product=product only %}

  <section class="product-serial">
    <div class="container container-fluid">
      {% if product.code %}
        <span class="product-serial-title">Код</span>
        <span class="product-serial-val">{{ product.code }}</span>
      {% endif %}

      {% if product.specification %}
        <span class="product-serial-title">Серия</span>
        {# TODO: `specification` should be replaced by `spec` #}
        <span class="product-serial-val">{{ product.specification }}</span>
      {% endif %}

      {% if product.mark %}
        <span class="product-serial-title">Марка</span>
        <span class="product-serial-val">{{ product.mark }}</span>
      {% endif %}

        <a class="category-price" href="{% url 'product_pdf' product.category.id %}">
          Скачать прайс <sup>[PDF]</sup>
        </a>
    </div>
  </section>

  <section class="product-info">
    <div class="container container-fluid">
      <div class="row">
        <div class="col-xs-12 col-md-7 col-lg-6 col-lg-offset-1">
          <div class="product-img-wrapper js-photoswipe">
            {% include 'catalog/product_image.html' with product=product only %}
          </div>
        </div>

        <div class="col-xs-12 col-md-5">
          <div class="product-characteristics">
            <table class="product-characteristics-table table">
              {% with url=product.category.url %}
                {% with spec=product.category.name|remove_specification:product.category.specification %}
                  {% show_field_if_exist spec 'Тип' url %}
                {% endwith %}
                {# TODO: `specification` should be replaced by `spec` #}
                {% show_field_if_exist product.category.specification 'Рабочая документация' url %}
              {% endwith %}
              {% show_field_if_exist product.length 'Длина (мм)' %}
              {% show_field_if_exist product.width 'Ширина (мм)' %}
              {% show_field_if_exist product.height 'Высота (мм)' %}
              {% show_field_if_exist product.diameter_out 'Внешний диаметр (мм)' %}
              {% show_field_if_exist product.diameter_in 'Внутренний диаметр (мм)' %}
              {% show_field_if_exist product.weight|floatformat:'0' 'Масса (кг)' %}
              {% show_field_if_exist product.volume 'Объем (м<sup>3</sup>)' %}
            </table>
          </div>
          <div class="product-order">
            <table class="product-order-table table">
              <tr>
                <th class="product-order-table-th">Цена</th>
                <th class="product-order-table-th">Кол-во</th>
                <th class="product-order-table-th">Итог</th>
              </tr>
              <tr>
                <td class="product-order-table-col-price js-product-price">
                  {{ product.price|format_price }}
                </td>
                <td class="product-order-table-col-count">
                  {% include 'catalog/count_input.html' %}
                </td>
                <td class="product-order-table-col-total">
                  <span class="js-product-sum">{{ product.price|format_price }}</span>
                </td>
              </tr>
            </table>

            <div class="public-offer product-order-public-offer">Не является публичной офертой</div>

            <div class="product-order-submit">
              <button class="btn buy-product" id="buy-product" data-product-id="{{ product.id }}"
                      type="submit">Заказать</button>
            </div>

          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12">
          <h2 class="product-describe-title">
            Производство ЖБИ: {{ page.h1 }} марки {{ product.mark }}
          </h2>
          <div class="product-describe-text">
            {# TODO: https://goo.gl/arjtqq #}
            {% autoescape off %}{{ page.content }}{% endautoescape %}
          </div>
        </div>
      </div>

    </div>
  </section>

  {% if sibling_with_images %}
    {% include 'catalog/product_siblings.html' with sibling_with_images=sibling_with_images only %}
  {% endif %}
{% endblock %}
